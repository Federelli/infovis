<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8'>

  <title>dc.js Experiment</title>

  <script src='js/d3.js' type='text/javascript'></script>
  <script src='js/crossfilter.js' type='text/javascript'></script>
  <script src='js/dc.js' type='text/javascript'></script>
  <script src='js/jquery-1.12.3.min.js' type='text/javascript'></script>
  <script src='js/bootstrap.min.js' type='text/javascript'></script>

  <link href='css/bootstrap.min.css' rel='stylesheet' type='text/css'>
  <link href='css/dc.css' rel='stylesheet' type='text/css'>

  <style type="text/css"></style>
  
  <style>
    h4 span {
      font-size:14px;
      font-weight:normal;
      }
    h2 {
      float: right;
    }
    h2 span {
      font-size:14px;
      font-weight:normal;
      }
  </style>
</head>

<body>

<div class='container' style='font: 12px sans-serif;'>
	<div class="dc-data-count" style="float: left;">
		<h2>Comicbook Trade Paperback Stats
		  <span>
			<span class="filter-count"></span>
			 selected out of 
			<span class="total-count"></span>
			 records | 
			<a href="javascript:dc.filterAll(); dc.renderAll();">Reset All</a>
		  </span>
		</h2>
	</div>
	<div class='row'>
		<div class='span4' id='dc-publisher-chart'>
		  <h4>
			Publisher
			<span>
			  <a class="reset"
				href="javascript:publisherChart.filterAll();dc.redrawAll();"
				style="display: none;">
				reset
			  </a>
			</span>
		  </h4>
		</div>   
	</div>
</div>
  
<script type="text/javascript">
// Create the dc.js chart objects & link to div
var dataTable = dc.dataTable("#dc-table-graph");
var publisherChart = dc.pieChart("#dc-publisher-chart");
  
// load data from a csv file
d3.csv("comics.csv", function (data) {

  // format our data
	var dateFormat = d3.time.format("%b-%Y");

	data.forEach(function(d) {
		d.pubDate = dateFormat.parse(d.date);
		d.name = +d.name;
		d.hero = +d.hero;
		d.company = +d.company;
		d.price = +d.price;
		d.pagecount = +d.pagecount;
		d.ratio = +d.ratio;
	});
   
  });
  
  // Run the data through crossfilter and load our 'facts'
  var facts = crossfilter(data);
  var all = facts.groupAll();
  
  // Pie Chart
  var publishers = facts.dimension(function (d) {
	return d.company;
    });
  var publishersGroup = publishers.group();
  
  // Create datatable dimension
  var timeDimension = facts.dimension(function (d) {
    return d.date;
  });
  
  // Setup the charts

  // count all the facts
  dc.dataCount(".dc-data-count")
    .dimension(facts)
    .group(all);
	
	// publishers pie chart
  publisherChart.width(250)
    .height(220)
    .radius(100)
    .innerRadius(30)
    .dimension(publishers)
    .title(function(d){return d.value;})
    .group(publishersGroup);
  
  // Table of earthquake data
  dataTable.width(960).height(800)
    .dimension(timeDimension)
	.group(function(d) { return "Earthquake Table"
	 })
	.size(10)
    .columns([
      function(d) { return d.date; },
      function(d) { return d.hero; },
      function(d) { return d.name; },
      function(d) { return d.company; },
	  function(d) { return d.price; },
      function(d) { return d.pagecount; }
    ])
    .sortBy(function(d){ return d.dtg; })
    .order(d3.ascending);

  // Render the Charts
  dc.renderAll();
  
</script>
    
</body>
</html>